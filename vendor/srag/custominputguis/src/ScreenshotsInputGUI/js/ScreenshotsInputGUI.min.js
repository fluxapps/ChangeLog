il.ScreenshotsInputGUI=function(a){this.post_var=a,this.screenshots=[],this.init()},il.ScreenshotsInputGUI.INSTANCES=[],il.ScreenshotsInputGUI.PAGE_SCREENSHOT_NAME="",il.ScreenshotsInputGUI.SCREENSHOT_TEMPLATE="",il.ScreenshotsInputGUI.lastInstance=function(){return this.INSTANCES[this.INSTANCES.length-1]},il.ScreenshotsInputGUI.newInstance=function(a){this.INSTANCES.push(new this(a))},il.ScreenshotsInputGUI.removeInstance=function(a){a.removePreviewURLCache();var b=this.INSTANCES.indexOf(a);this.INSTANCES.splice(b,1)},il.ScreenshotsInputGUI.prototype={constructor:il.ScreenshotsInputGUI,element:null,modal:null,post_var:"",previewURLCache:[],screenshots:[],addPageScreenshot:function(){this.hideModal(),html2canvas($("html")[0]).then(function(a){this.restoreModal(),a.toBlob(function(a){var b=new File([a],this.constructor.PAGE_SCREENSHOT_NAME+".png",{type:a.type});this.screenshots.push(b),this.updateScreenshots()}.bind(this),"image/png")}.bind(this)).catch(function(a){this.restoreModal(),alert(a)}.bind(this))},addScreenshot:function(){var a=$(".screenshot_file_input",this.element);a.click()},addScreenshotOnChange:function(){var a=$(".screenshot_file_input",this.element)[0];""!==a.value&&(Array.prototype.forEach.call(a.files,function(a){this.screenshots.push(a)},this),a.value="",this.updateScreenshots())},addScreenshotsToUpload:function(a){this.screenshots.forEach(function(b){a.append(this.post_var+"[]",b)},this),this.removePreviewURLCache()},hideModal:function(){null!==this.modal&&(this.modal.css("visibility","hidden"),$(".modal-backdrop").css("visibility","hidden"),$("body").css("overflow","visible"))},init:function(){this.element=$("input[type=\"file\"][name=\""+this.post_var+"\"]").parent();var a=$(".add_screenshot",this.element),b=$(".add_page_screenshot",this.element),c=$(".screenshot_file_input",this.element);a.click(this.addScreenshot.bind(this)),b.click(this.addPageScreenshot.bind(this)),c.change(this.addScreenshotOnChange.bind(this))},removePreviewURLCache:function(){this.previewURLCache.forEach(function(a){URL.revokeObjectURL(a)}),this.previewURLCache=[]},removeScreenshot:function(a){var b=this.screenshots.indexOf(a);this.screenshots.splice(b,1),this.updateScreenshots()},restoreModal:function(){null!==this.modal&&(this.modal.css("visibility",""),$(".modal-backdrop").css("visibility",""),$("body").css("overflow",""))},updateScreenshots:function(){var a=$(".screenshots",this.element);a.empty(),this.removePreviewURLCache(),this.screenshots.forEach(function(b){var c=$(this.constructor.SCREENSHOT_TEMPLATE),d=$(".screenshot_name",c),e=$(".screenshot_remove",c),f=$(".screenshot_preview_link",c),g=$(".screenshot_preview",c),h=URL.createObjectURL(b);d.text(b.name),e.click(this.removeScreenshot.bind(this,b)),f.prop("href",h),g.prop("src",h),g.prop("alt",b.name),a.append(c),this.previewURLCache.push(h)},this)}};